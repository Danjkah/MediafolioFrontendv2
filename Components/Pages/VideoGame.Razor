@page "/videogame"
@using Mediafolio.Services;
@using Mediafolio.Models;
@inject Mediafolio.Services.IVideoGameService VideoGameService;

<PageTitle>Video Game Collection</PageTitle>

<div class="container mt-4">
    <h2>Video Game Collection</h2>

    <!-- Loading Indicator -->
    @if(isLoading)
    {
        <div class="text-center my-5">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">Retrieving video games...</p>
        </div>
    }

    <!-- Error Message -->
    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <div class="alert alert-danger alert-dismissible" role="alert">
            <strong>Error:</strong> @errorMessage
            <button type="button" class="btn-close" @onclick="ClearError"></button>
        </div>
    }

    <!-- No Results Message -->
    @if (!isLoading && videoGames.Count == 0 && string.IsNullOrEmpty(errorMessage))
    {
        <div class="alert alert-info">
            No video games found.
            <button class="btn btn-primary w-100"
                @onclick="GetVideoGames"
                disabled="@isLoading">
                    <span>Reload video games.</span>
            </button>
        @videoGames.Count
        </div>
    }

    <!-- Results -->
    @if (videoGames.Count > 0 && !isLoading)
    {
        <h4 class="mb-3">Found @videoGames.Count result@(videoGames.Count != 1 ? "s" : "")</h4>

        <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-3">
            @foreach (var videoGame in videoGames)
            {
                <VideoGameCard VideoGameData = "@videoGame"></VideoGameCard>
            }
        </div>
    }
</div>

@code 
{
    private List<Mediafolio.Models.VideoGame> videoGames = new List<Mediafolio.Models.VideoGame>();
    private bool isLoading = false;
    private string? errorMessage = null;

    private async Task GetVideoGames()
    {
        try 
        {
            isLoading = true;
            errorMessage = null;
            videoGames.Clear();
            
            List<Mediafolio.Models.VideoGame>? results = await VideoGameService.GetAllGamesAsync();

            if(results is not null)
            {
                videoGames = results;
            }
        }
        catch(Exception e)
        {
            errorMessage = e.Message;
        }
        finally
        {
            isLoading = false;
        }
    }
    
    void ClearError()
    {
        errorMessage = null;
    }

    protected override async Task OnInitializedAsync()
    {
        await GetVideoGames();
    }
}