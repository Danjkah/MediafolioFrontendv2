@page "/reviews/{mediaId:int}"
@using MediafolioFrontend.Services
@using MediafolioFrontend.Models
@using MediafolioFrontend.Enums
@rendermode InteractiveServer
@inject IReviewService reviewService

@inject IVideoService videoService
@inject NavigationManager navigation



<div class = "row">
    <button class = "btn btn-outline-primary mb-3" @onclick="() => GoBack(mediaId)">
        ‚Üê Back to Video Entries
    </button>
    @foreach(var review in reviews)
    {
        @if (review.MediaObjectId == mediaId)
        {
            <div>
            <h1>@review.Title</h1>
                
                
                @review.Content
                    
                <br />
                <small>
                <strong>User Rating: </strong> @review.Rating /5 
                </small>
                <br />
                <small>
                <strong>Review Created At:</strong> @review.CreatedAt.ToString("MMMM dd, yyyy")
                </small>
                
                
            </div>
        }
    }

</div>



@code 
{
    [Parameter]
    public int mediaId {get;set;} = int.MaxValue;

    private List<Reviews> reviews = new List<Reviews>();
    private bool isLoading = false;

    private string? errorMessage = null;

    private bool hasSearched = false; 

    private async Task GetVideoReviews()
    {
                try
        {

            isLoading = true;
            errorMessage = null;
            hasSearched = true; 

            var loadResults = await reviewService.GetAllReviews();

            reviews = loadResults;

        }
        catch (Exception ex)
        {
            errorMessage = ex.Message;
        }
        finally
        {
            isLoading = false;
        }

    }
    //https://stackoverflow.com/questions/61551404/in-blazor-how-to-call-a-function-at-page-load-event-name
    protected override async Task OnInitializedAsync()
    {
       await GetVideoReviews();
    }

    private async Task GoBack(int mediaId)
    {

        //I need the video idea I have the media id
        // I need to search through all my video objects and find the one with the given media id

        var allVideos = await videoService.GetAllVideosAsync();
        foreach(var video in allVideos)
        {
            @if (video.MediaObjectId == mediaId ){
                var videoId = video.Id; 
                Console.WriteLine(video.Id);
                navigation.NavigateTo($"/video/{videoId}");
                return;
            }
            
        }
        navigation.NavigateTo($"/videoHome");
    }
    
}