@page "/logs/{mediaId:int}"
@using MediafolioFrontend.Services
@using MediafolioFrontend.Models
@using MediafolioFrontend.Enums
@using System.Threading.Tasks
@rendermode InteractiveServer
@inject ILogService logService
@inject IVideoService videoService
@inject NavigationManager navigation


<PageTitle>Your Daily Log Entries</PageTitle>
<div class="container mt-4">

    <button class = "btn btn-outline-primary mb-3" @onclick="() => GoBack(mediaId)">
        ‚Üê Back to Video Entries
    </button>

<h2>Your Daily Log Entries</h2>

        <div class="row row-cols-1 row-cols-md-3 row-cols-lg-3 g-3">
            @foreach(var dailyLog in dailyLogs)
            {
                @if(dailyLog.MediaObjectId == mediaId)
                {
                <div class = "col">
                    <div class="card h-100 movie-card" @onclick="() => NavigateToDetails(dailyLog.Id)">

                        <div class = "no-poster">
                            <span>üìΩÔ∏è</span>
                        </div>

                        <div class = "card-body">
                            <h6 class="card-title">@dailyLog.CreatedAt.ToString("MMMM dd, yyyy 'at' hh:mm:tt")</h6>
                            <p class="card-text">
                                <small>Usage Time: @dailyLog.UsageTime minutes</small><br />
                            </p>
                        </div>
                    </div>
                </div>
                }
            }
        </div>




</div>




@code

{
    [Parameter]
    public int mediaId {get;set;} = int.MaxValue;


    private List<DailyLogs> dailyLogs = new List<DailyLogs>();
    private bool isLoading = false;

    private string? errorMessage = null;

    private bool hasSearched = false; 



    private async Task GetDailyLogs()
    {
        try
        {

            isLoading = true;
            errorMessage = null;
            hasSearched = true; 

            var loadResults = await logService.GetAllDailyLogs();

            dailyLogs = loadResults;

            Console.WriteLine(dailyLogs);
            Console.WriteLine(dailyLogs[0].Content);
        }
        catch (Exception ex)
        {
            errorMessage = ex.Message;
        }
        finally
        {
            isLoading = false;
        }

    }

    protected override async Task OnInitializedAsync()
    {


        await GetDailyLogs();


    }
    private void NavigateToDetails(int logId)
    {
        Console.WriteLine("something is happening");
        navigation.NavigateTo($"/logDetails/{logId}");
    }

    private async Task GoBack(int mediaId)
    {

        //I need the video idea I have the media id
        // I need to search through all my video objects and find the one with the given media id

        var allVideos = await videoService.GetAllVideosAsync();
        foreach(var video in allVideos)
        {
            @if (video.MediaObjectId == mediaId ){
                var videoId = video.Id; 
                Console.WriteLine(video.Id);
                navigation.NavigateTo($"/video/{videoId}");
                return;
            }
            
        }
        navigation.NavigateTo($"/videoHome");
    }
}