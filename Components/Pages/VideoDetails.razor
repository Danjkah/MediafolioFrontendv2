@page "/video/{videoId:int}"
@using MediafolioFrontend.Services
@using MediafolioFrontend.Models
@using MediafolioFrontend.Enums
@rendermode InteractiveServer
@inject IVideoService videoService
@inject NavigationManager navigation

<PageTitle>@(videoDetails?.Title ?? "Video Details")</PageTitle>
<div class = "container mt-4">
    <button class = "btn btn-outline-primary mb-3" @onclick="GoBack">
        ‚Üê Back to Video Entries
    </button>

        <!-- Loading Indicator -->
    @if (isLoading)
    {
        <div class="text-center my-5">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">Loading Video details...</p>
        </div>
        
    }

        @if (!string.IsNullOrEmpty(errorMessage))
    {
        <div class="alert alert-danger">
            <h4>Error Loading Video</h4>
            <p>@errorMessage</p>
        </div>
    }



    @if (videoDetails != null && !isLoading)
    {
        <div class = "row">

               <div>
                <h1>@videoDetails.Title</h1>
               </div>
               <div>
               
                @foreach(var tag in videoDetails.Tags)
                {
                    <span class="badge bg-primary mx-1">@tag </span>
                }
               </div>
            <hr class="mt-3 mb-2"/>
               
               <h4 class="text-body-secondary">Description:</h4>
               
               <div class = "mb-3 mt-2">@videoDetails.Description</div>
               


                <small>
                <strong>Number of episodes: </strong> @videoDetails.NumberOfEpisodes
                </small>
                <small>
                <strong>Average Episode Length:</strong> @videoDetails.VideoDuration hour
                </small>

                <small>
                <strong>User Watch Time:</strong> @videoDetails.UserWatchTime hours
                </small>

                <hr class="mt-2 mb-2"/>

                <small>
               Created at: @videoDetails.CreatedAt.ToString("MMMM dd, yyyy")
               </small>
               @if (videoDetails.UpdatedAt != DateTime.MinValue)
               {
                <small>
                Updated on: @videoDetails.CreatedAt.ToString("MMMM dd, yyyy 'at' hh:mm:tt")
                </small>
               }

        
        </div>
    }

<div class ="row mt-2">
    <button @onclick="() => NavigateToReviews(videoDetails.MediaObjectId)">
    View Your Review on Entry
    </button>

    <button class = "mt-1 mb-2" @onclick="() => NavigateToLogs(videoDetails.MediaObjectId)">
    View Your Daily Logs
    </button>

</div>

</div>




@code{
    [Parameter]
    public int videoId {get;set;} = int.MaxValue;

    private Video? videoDetails = null;

    private bool isLoading = false;

    private string? errorMessage = null;

    protected override async Task OnInitializedAsync(){
        await LoadVideoDetails();
    }

    private async Task LoadVideoDetails(){
        try{
            isLoading = true;
            errorMessage = null;
            if (int.MaxValue == videoId)
            {
                errorMessage = "Invalid movie ID.";
                return;
            }            

            videoDetails = await videoService.GetVideoIdAsync(videoId);

            if (videoDetails == null)
            {
                errorMessage = "something went wrong while getting the video details, try again";
            }

        }catch(Exception ex)
        {
            errorMessage = ex.Message; 
        }finally
        {
            isLoading = false; 
        }
    }
    private void GoBack()
    {
        navigation.NavigateTo("/videoHome");
    }

    private void NavigateToReviews(int mediaIb)
    {
        Console.WriteLine("something is happening");
        navigation.NavigateTo($"/reviews/{mediaIb}");
    }

    private void NavigateToLogs(int mediaIb)
    {
        Console.WriteLine("something is happening");
        navigation.NavigateTo($"/logs/{mediaIb}");
    }
}